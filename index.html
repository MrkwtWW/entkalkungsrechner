<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Entkalkungsrechner</title>
<style>
  :root{
    --bg: #f4f7fb;
    --card: #ffffff;
    --accent: #c2cb20; /* Firmenfarbe */
    --accent-text: #341e17; /* Textfarbe für Buttons */
    --muted: #6b7280;
    --glass: rgba(255,255,255,0.7);
  }
  *{box-sizing:border-box}
  body{
    font-family: Inter, "Helvetica Neue", Arial, sans-serif;
    background: var(--bg);
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:24px;
    margin:0;
  }

  .card{
    width:100%;
    max-width:820px;
    background:var(--card);
    border-radius:14px;
    padding:20px;
    box-shadow: 0 10px 30px rgba(18,38,63,0.08);
    display:grid;
    grid-template-columns: 360px 1fr;
    gap:20px;
    align-items:start;
  }

  h1{margin:0 0 8px 0; font-size:20px}
  p.lead{margin:0 0 16px 0; color:var(--muted); font-size:14px}

  .controls{
    display:flex;
    flex-direction:column;
    gap:10px;
  }

  label{font-size:13px; color:var(--muted); margin-bottom:6px; display:block}
  input[type="number"], input[type="text"]{
    width:100%;
    padding:10px 12px;
    border-radius:8px;
    border:1px solid #e6e9ef;
    font-size:15px;
    outline:none;
    background:transparent;
  }
  .row{display:flex; gap:10px}

  /* Normale Buttons */
  button{
    padding:10px 12px;
    border-radius:10px;
    border: none;
    font-size:15px;
    cursor:pointer;
    background:var(--accent);
    color:var(--accent-text);
    box-shadow:0 6px 18px rgba(0,0,0,0.15);
    display:inline-flex;
    align-items:center;
    gap:8px;
    font-weight:600;
    transition: background 0.2s ease, color 0.2s ease;
  }
  button:hover{
    background:#b0b81d; /* leicht dunkler beim Hover */
  }

  /* Ghost-Buttons */
  button.ghost{
    background:transparent;
    color:var(--muted);
    border:1px solid #e6e9ef;
    box-shadow:none;
  }
  button.ghost:hover{
    background:var(--accent);
    color:var(--accent-text);
    border-color:var(--accent);
  }

  button.small{padding:8px 10px; font-size:14px; border-radius:8px}

  .muted{color:var(--muted); font-size:13px}

  /* right column */
  .display{
    padding:12px;
    border-radius:10px;
    background:linear-gradient(180deg,#fafbfd,#f6f9fc);
    min-height:220px;
    display:flex;
    gap:16px;
    align-items:center;
  }

  /* Tank visual */
  .tank-wrap{width:120px; display:flex; align-items:center; justify-content:center}
  svg{width:100%; height:auto; display:block}
  .stats{flex:1}
  .big{font-size:18px; font-weight:600}
  .percent{font-size:13px; color:var(--muted); margin-top:6px}
  .notice{margin-top:8px; font-weight:600; color:#c53030}

  .controls .hint{font-size:12px; color:var(--muted)}
  .compact{display:flex; gap:8px; align-items:center}
  .fillbar{
    height:10px;
    width:100%;
    background:#e6eef0;
    border-radius:999px;
    overflow:hidden;
    margin-top:8px;
  }
  .fill{height:100%; width:0%; background:linear-gradient(90deg,#4caf50,#7ce38c); transition:width .4s}
  footer{grid-column:1 / -1; text-align:center; margin-top:8px; font-size:12px; color:var(--muted)}
  @media (max-width:800px){
    .card{grid-template-columns:1fr; padding:16px}
  }
</style>
</head>
<body>

<div class="card" role="application" aria-label="Entkalkungsrechner">
  <div class="controls">
    <h1>Entkalkungsrechner</h1>
    <p class="lead">Gib die Wasserhärte ein. Rechner: <strong>2000 ÷ Härte = Liter bis zur nächsten Entkalkung</strong>.</p>

    <div>
      <label for="waterHardness">Wasserhärte (°dH)</label>
      <input id="waterHardness" type="number" min="0.1" step="0.1" value="20" />
    </div>

    <div class="row">
      <button id="calculateButton" title="Berechnung starten">Berechnen</button>
      <button id="resetButton" class="ghost" title="Zurücksetzen" disabled>Reset</button>
    </div>

    <div class="muted" id="formula">Rechnung: —</div>

    <hr style="border:none;height:1px;background:#eef2f5;margin:10px 0;border-radius:2px" />

    <div>
      <label for="tankCapacity">Wassertank-Kapazität (L)</label>
      <div class="row">
        <input id="tankCapacity" type="number" min="0" step="0.1" value="2.8" />
        <button id="useTankButton" class="small" title="Tank entleeren (add Verbrauch)">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden focusable="false" xmlns="http://www.w3.org/2000/svg"><path d="M12 3s5 5 5 8a5 5 0 11-10 0c0-3 5-8 5-8z" fill="currentColor"/></svg>
          Tank verbrauchen
        </button>
      </div>
      <div class="hint">Klick addiert den Tankinhalt zur Verbrauchszählung (z. B. 2.8 L).</div>
    </div>

    <div style="margin-top:8px;">
      <label for="consumeInput">Manuell Liter abziehen (z. B. 1)</label>
      <div class="row">
        <input id="consumeInput" type="number" min="0" step="0.1" value="1" />
        <button id="consumeButton" class="small">Abziehen</button>
        <button id="consume1Button" class="small ghost">Schnell 1 L</button>
      </div>
      <div class="hint">Gib z. B. 1 L ein, wenn du genau 1 Liter verbraucht / nachgefüllt hast.</div>
    </div>

    <div style="margin-top:12px;">
      <button id="undoButton" class="ghost small" disabled>Letzten Schritt rückgängig</button>
    </div>
  </div>

  <div class="display" aria-live="polite">
    <div class="tank-wrap" role="img" aria-label="Tank-Füllstand">
      <svg id="tankSvg" viewBox="0 0 120 260" xmlns="http://www.w3.org/2000/svg" aria-hidden>
        <rect x="12" y="20" rx="12" ry="12" width="96" height="200" fill="none" stroke="#d6dde3" stroke-width="4" />
        <g id="fillGroup">
          <rect id="fillRect" x="12" y="220" width="96" height="0" rx="10" ry="10" fill="#4caf50" />
        </g>
        <path d="M60 12c-4 0-16 12-16 24 0 22 32 22 32 0 0-12-12-24-16-24z" fill="#2d9e63" opacity="0.9"/>
      </svg>
    </div>

    <div class="stats">
      <div class="big" id="litersToDescaleText">Nächste Entkalkung: — L</div>
      <div class="muted" id="remainingText">Verbleibend: — L</div>
      <div class="fillbar" aria-hidden>
        <div class="fill" id="progressFill" style="width:0%"></div>
      </div>
      <div class="percent" id="percentText">—%</div>
      <div class="notice" id="notice" style="display:none">Jetzt entkalken!</div>
    </div>
  </div>

  <footer>Hinweis: Formel = <strong>2000 ÷ Wasserhärte</strong>. Beispiel: 2000 ÷ 20 = 100 L</footer>
</div>

<script>
(function(){
  let usedLiters = 0;
  let litersToDescale = null;
  let lastAction = null;

  const waterHardnessInput = document.getElementById('waterHardness');
  const calculateButton = document.getElementById('calculateButton');
  const resetButton = document.getElementById('resetButton');
  const formula = document.getElementById('formula');

  const tankCapacityInput = document.getElementById('tankCapacity');
  const useTankButton = document.getElementById('useTankButton');

  const consumeInput = document.getElementById('consumeInput');
  const consumeButton = document.getElementById('consumeButton');
  const consume1Button = document.getElementById('consume1Button');

  const undoButton = document.getElementById('undoButton');

  const litersToDescaleText = document.getElementById('litersToDescaleText');
  const remainingText = document.getElementById('remainingText');
  const progressFill = document.getElementById('progressFill');
  const percentText = document.getElementById('percentText');
  const notice = document.getElementById('notice');
  const fillRect = document.getElementById('fillRect');

  function fmt(n){
    if (n === null || isNaN(n)) return '—';
    return (Math.abs(n) >= 1000) ? n.toFixed(0) : n.toFixed(2);
  }

  function enableControls(enabled){
    useTankButton.disabled = !enabled;
    consumeButton.disabled = !enabled;
    consume1Button.disabled = !enabled;
    undoButton.disabled = !enabled || !lastAction;
  }

  function updateDisplay(){
    if (litersToDescale === null){
      litersToDescaleText.textContent = "Nächste Entkalkung: — L";
      remainingText.textContent = "Verbleibend: — L";
      percentText.textContent = "—%";
      progressFill.style.width = '0%';
      notice.style.display = 'none';
      fillRect.setAttribute('height', 0);
      fillRect.setAttribute('y', 220);
      enableControls(false);
      return;
    }

    const remaining = Math.max(0, litersToDescale - usedLiters);
    const percentUsed = Math.min(100, (usedLiters / litersToDescale) * 100);
    litersToDescaleText.textContent = `Nächste Entkalkung: ${fmt(litersToDescale)} L`;
    remainingText.textContent = `Verbleibend: ${fmt(remaining)} L (verbraucht ${fmt(usedLiters)} L)`;
    percentText.textContent = `${percentUsed.toFixed(1)}%`;
    progressFill.style.width = `${percentUsed}%`;

    const tankTopY = 20;
    const tankHeight = 200;
    const fillHeight = Math.round((percentUsed / 100) * tankHeight);
    const newY = tankTopY + (tankHeight - fillHeight);
    fillRect.setAttribute('height', String(fillHeight));
    fillRect.setAttribute('y', String(newY));

    if (percentUsed >= 100) {
      notice.style.display = 'block';
      usedLiters = litersToDescale;
    } else {
      notice.style.display = 'none';
    }

    enableControls(true);
  }

  calculateButton.addEventListener('click', () => {
    const h = parseFloat(waterHardnessInput.value);
    if (isNaN(h) || h <= 0) {
      alert('Bitte eine gültige Wasserhärte > 0 eingeben.');
      return;
    }
    litersToDescale = 2000 / h;
    usedLiters = 0;
    formula.textContent = `Rechnung: 2000 ÷ ${h} = ${fmt(litersToDescale)} L`;
    waterHardnessInput.disabled = true;
    calculateButton.disabled = true;
    resetButton.disabled = false;
    lastAction = null;
    undoButton.disabled = true;
    updateDisplay();
  });

  resetButton.addEventListener('click', () => {
    if (!confirm('Zurücksetzen? Alle Zähler werden gelöscht.')) return;
    litersToDescale = null;
    usedLiters = 0;
    formula.textContent = 'Rechnung: —';
    waterHardnessInput.disabled = false;
    calculateButton.disabled = false;
    resetButton.disabled = true;
    lastAction = null;
    undoButton.disabled = true;
    updateDisplay();
  });

  function consumeLiters(amount){
    if (litersToDescale === null) {
      alert('Bitte zuerst die Entkalkungsmenge berechnen.');
      return;
    }
    amount = Number(amount) || 0;
    if (amount <= 0) { alert('Gib eine Zahl > 0 ein.'); return; }
    lastAction = {type:'consume', amount: amount};
    usedLiters = +(usedLiters + amount).toFixed(4);
    undoButton.disabled = false;
    updateDisplay();
  }

  useTankButton.addEventListener('click', () => {
    const cap = parseFloat(tankCapacityInput.value);
    if (isNaN(cap) || cap <= 0) {
      alert('Bitte eine gültige Tankkapazität (>0) eingeben.');
      return;
    }
    if (litersToDescale === null){
      const h = parseFloat(waterHardnessInput.value);
      if (isNaN(h) || h <= 0) {
        alert('Bitte zuerst Wasserhärte eingeben und Berechnen.');
        return;
      }
      litersToDescale = 2000 / h;
      formula.textContent = `Rechnung: 2000 ÷ ${h} = ${fmt(litersToDescale)} L`;
      waterHardnessInput.disabled = true;
      calculateButton.disabled = true;
      resetButton.disabled = false;
    }
    consumeLiters(cap);
  });

  consumeButton.addEventListener('click', () => {
    consumeLiters(parseFloat(consumeInput.value));
  });

  consume1Button.addEventListener('click', () => {
    consumeLiters(1);
  });

  undoButton.addEventListener('click', () => {
    if (!lastAction) return;
    if (lastAction.type === 'consume') {
      usedLiters = Math.max(0, +(usedLiters - lastAction.amount).toFixed(4));
      lastAction = null;
      undoButton.disabled = true;
      updateDisplay();
    }
  });

  updateDisplay();

  waterHardnessInput.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter') calculateButton.click();
  });
  consumeInput.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter') consumeButton.click();
  });
})();
</script>

</body>
</html>
